# MART Layer - Products Dimension Table Quality Checks
# Database: SODA_CERTIFICATION, Schema: MART
# Table: DIM_PRODUCTS (1,000+ records)
# 
# DECISION: "Can we trust this for product analytics and recommendations?"
# RISK: Duplicate products = wrong metrics, wrong prices = wrong decisions, stale data = missed opportunities
# QUALITY DIMENSIONS: Uniqueness (double-counting), Accuracy (wrong values), Timeliness (stale data), Schema

# Dataset discovery configuration for Soda Cloud
discover datasets:
  datasets:
    - include DIM_PRODUCTS

# Column profiling configuration for Soda Cloud
profile columns:
  columns:
    - DIM_PRODUCTS.%
    - exclude DIM_PRODUCTS.CREATED_AT
    - exclude DIM_PRODUCTS.UPDATED_AT

# Sample datasets configuration for Soda Cloud
sample datasets:
  datasets:
    - include DIM_PRODUCTS

checks for DIM_PRODUCTS:
  # Schema validation - structure matters for consumption
  - schema:
      name: "Product dimension schema validation"
      attributes:
        dimension: Accuracy
      fail:
        when required column missing: [PRODUCT_ID, PRODUCT_NAME, CATEGORY, SUBCATEGORY, PRICE, CURRENCY, DESCRIPTION, BRAND, SKU, WEIGHT, DIMENSIONS, CREATED_AT, UPDATED_AT]
        when forbidden column present: []
        when wrong column type:
          PRODUCT_ID: varchar
          PRODUCT_NAME: varchar
          CATEGORY: varchar
          SUBCATEGORY: varchar
          PRICE: decimal
          CURRENCY: varchar
          DESCRIPTION: varchar
          BRAND: varchar
          SKU: varchar
          WEIGHT: decimal
          DIMENSIONS: varchar
          CREATED_AT: timestamp
          UPDATED_AT: timestamp
  
  # Uniqueness - duplicate products = wrong metrics
  - duplicate_count(PRODUCT_ID) = 0:
      name: "Product IDs are unique in mart"
      attributes:
        dimension: Uniqueness
  
  - duplicate_count(SKU) = 0:
      name: "SKUs are unique in mart"
      attributes:
        dimension: Uniqueness
  
  # Accuracy - wrong prices = wrong business decisions
  - min(PRICE) >= 0:
      name: "All prices are non-negative in mart"
      attributes:
        dimension: Accuracy
  
  - max(PRICE) <= 10000:
      name: "All prices are within business limits in mart"
      attributes:
        dimension: Accuracy
  
  # Timeliness - stale product data = missed opportunities
  - freshness(CREATED_AT) < 30:
      name: "Product dimension data is fresh"
      attributes:
        dimension: Timeliness
