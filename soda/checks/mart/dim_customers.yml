# MART Layer - Customer Dimension Table Quality Checks
# Database: SODA_CERTIFICATION, Schema: MART
# Table: dim_customers (10,000+ records)
# 
# DECISION: "Can we trust this for customer analytics, segmentation, and personalization?"
# RISK: Wrong customer segmentation, duplicate customers = wrong targeting, stale data = missed opportunities
# QUALITY DIMENSIONS: Uniqueness (double-counting), Accuracy (wrong values), Timeliness (stale data), Schema

# Dataset discovery configuration for Soda Cloud
discover datasets:
  datasets:
    - include DIM_CUSTOMERS

# Soda Cloud Profiling Configuration for Partner Certification
profile columns:
  columns:
    - DIM_CUSTOMERS.%
    - exclude DIM_CUSTOMERS.CREATED_AT
    - exclude DIM_CUSTOMERS.UPDATED_AT
    - exclude DIM_CUSTOMERS.INGESTION_TIMESTAMP
    - exclude DIM_CUSTOMERS.HAS_MISSING_EMAIL
    - exclude DIM_CUSTOMERS.HAS_MISSING_PHONE
    - exclude DIM_CUSTOMERS.HAS_MISSING_NAME
    - exclude DIM_CUSTOMERS.FIRST_ORDER_DATE
    - exclude DIM_CUSTOMERS.LAST_ORDER_DATE
    - exclude DIM_CUSTOMERS.DAYS_SINCE_LAST_ORDER
    - exclude DIM_CUSTOMERS.ORDERS_PER_MONTH

# Sample datasets configuration for Soda Cloud
sample datasets:
  datasets:
    - include DIM_CUSTOMERS

checks for DIM_CUSTOMERS:
  # Schema validation - structure matters for consumption
  - schema:
      name: "Mart customer dimension schema validation"
      attributes:
        dimension: Accuracy
      fail:
        when required column missing: [CUSTOMER_ID, FIRST_NAME, LAST_NAME, EMAIL, DATA_QUALITY_SCORE]
        when forbidden column present: [DUPLICATE_ID, TEST_COLUMN]
  
  # Uniqueness - duplicate customers = wrong targeting, wrong attribution
  - duplicate_count(CUSTOMER_ID) = 0:
      name: "Customer IDs are unique in mart"
      attributes:
        dimension: Uniqueness
  
  - duplicate_count(EMAIL) = 0:
      name: "Emails are unique in mart"
      attributes:
        dimension: Uniqueness
  
  # Accuracy - wrong customer attributes = wrong segmentation
  - min(DATA_QUALITY_SCORE) > 80:
      name: "All customers have high data quality score"
      attributes:
        dimension: Accuracy
  
  # Timeliness - stale customer data = missed opportunities
  - freshness(CREATED_AT) < 1d:
      name: "Mart customer data is fresh"
      attributes:
        dimension: Timeliness
