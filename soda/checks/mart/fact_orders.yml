# MART Layer - Orders Fact Table Quality Checks
# Database: SODA_CERTIFICATION, Schema: MART
# Table: fact_orders (20,000+ records)
# 
# DECISION: "Can we trust this for financial reporting, revenue analytics, and business decisions?"
# RISK: Duplicate orders = inflated revenue, wrong amounts = financial errors, stale data = missed insights
# QUALITY DIMENSIONS: Uniqueness (double-counting), Accuracy (wrong values), Timeliness (stale data), Schema

# Dataset discovery configuration for Soda Cloud
discover datasets:
  datasets:
    - include FACT_ORDERS

# Soda Cloud Profiling Configuration for Partner Certification
profile columns:
  columns:
    - FACT_ORDERS.%
    - exclude FACT_ORDERS.ORDER_DATE
    - exclude FACT_ORDERS.CREATED_AT
    - exclude FACT_ORDERS.UPDATED_AT
    - exclude FACT_ORDERS.INGESTION_TIMESTAMP
    - exclude FACT_ORDERS.ORDER_YEAR
    - exclude FACT_ORDERS.ORDER_MONTH
    - exclude FACT_ORDERS.ORDER_DAY_OF_WEEK
    - exclude FACT_ORDERS.ORDER_QUARTER
    - exclude FACT_ORDERS.HAS_INVALID_CUSTOMER
    - exclude FACT_ORDERS.HAS_NEGATIVE_AMOUNT
    - exclude FACT_ORDERS.HAS_INVALID_STATUS
    - exclude FACT_ORDERS.HAS_FUTURE_DATE
    - exclude FACT_ORDERS.HAS_INVALID_CURRENCY
    - exclude FACT_ORDERS.HAS_AMOUNT_MISMATCH
    - exclude FACT_ORDERS.HAS_ORPHANED_ORDER
    - exclude FACT_ORDERS.HAS_SLOW_DELIVERY

# Sample datasets configuration for Soda Cloud
sample datasets:
  datasets:
    - include FACT_ORDERS

checks for FACT_ORDERS:
  # Schema validation - structure matters for consumption
  - schema:
      name: "Mart order fact table schema validation"
      attributes:
        dimension: Accuracy
      fail:
        when required column missing: [ORDER_ID, CUSTOMER_ID, ORDER_TOTAL_AMOUNT, ORDER_STATUS]
        when forbidden column present: [DUPLICATE_ORDER_ID, TEST_COLUMN]
  
  # Uniqueness - duplicate orders = inflated revenue, wrong metrics
  - duplicate_count(ORDER_ID) = 0:
      name: "Order IDs are unique in mart"
      attributes:
        dimension: Uniqueness
  
  # Accuracy - wrong amounts = financial errors
  - min(ORDER_TOTAL_AMOUNT) > 0:
      name: "All order amounts are positive in mart"
      attributes:
        dimension: Accuracy
  
  - max(ORDER_TOTAL_AMOUNT) <= 10000:
      name: "All order amounts are within business range"
      attributes:
        dimension: Accuracy
