# RAW Layer - Customers Table Quality Checks
# Database: SODA_CERTIFICATION, Schema: RAW
# Table: CUSTOMERS (10,000+ records)
# 
# DECISION: "Should we ingest this data without breaking the pipeline?"
# RISK: Pipeline breaks, downstream transformations fail
# QUALITY DIMENSIONS: Validity (format/type errors), Schema (missing columns)

# Dataset discovery configuration for Soda Cloud
discover datasets:
  datasets:
    - include CUSTOMERS

# Column profiling configuration for Soda Cloud
profile columns:
  columns:
    - CUSTOMERS.%
    - exclude CUSTOMERS.CREATED_AT
    - exclude CUSTOMERS.UPDATED_AT

# Sample datasets configuration for Soda Cloud
sample datasets:
  datasets:
    - include CUSTOMERS

checks for CUSTOMERS:
  # Schema validation - prevents transformation failures
  - schema:
      name: "Customer table schema validation"
      attributes:
        dimension: Validity
      fail:
        when required column missing: [CUSTOMER_ID, FIRST_NAME, LAST_NAME, EMAIL, PHONE, ADDRESS, CITY, STATE, ZIP_CODE, COUNTRY, CREATED_AT, UPDATED_AT]
        when forbidden column present: []
        when wrong column type:
          CUSTOMER_ID: varchar
          FIRST_NAME: varchar
          LAST_NAME: varchar
          EMAIL: varchar
          PHONE: varchar
          ADDRESS: varchar
          CITY: varchar
          STATE: varchar
          ZIP_CODE: varchar
          COUNTRY: varchar
          CREATED_AT: timestamp
          UPDATED_AT: timestamp
  
  # Validity checks - format errors break pipelines
  - invalid_count(EMAIL) < 500:
      name: "Invalid email formats"
      valid regex: '^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
      attributes:
        dimension: Validity
  
  - invalid_count(PHONE) < 300:
      name: "Invalid phone formats"
      valid regex: '^[0-9\-\+\(\)\s]+$'
      attributes:
        dimension: Validity
