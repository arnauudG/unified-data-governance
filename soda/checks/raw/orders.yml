# RAW Layer - Orders Table Quality Checks
# Database: SODA_CERTIFICATION, Schema: RAW
# Table: ORDERS (20,000+ records)
# 
# DECISION: "Should we ingest this data without breaking the pipeline?"
# RISK: Pipeline breaks, downstream transformations fail
# QUALITY DIMENSIONS: Validity (format/type errors), Schema (missing columns)

# Dataset discovery configuration for Soda Cloud
discover datasets:
  datasets:
    - include ORDERS

# Column profiling configuration for Soda Cloud
profile columns:
  columns:
    - ORDERS.%
    - exclude ORDERS.CREATED_AT
    - exclude ORDERS.UPDATED_AT

# Sample datasets configuration for Soda Cloud
sample datasets:
  datasets:
    - include ORDERS

checks for ORDERS:
  # Schema validation - prevents transformation failures
  - schema:
      name: "Order table schema validation"
      attributes:
        dimension: Validity
      fail:
        when required column missing: [ORDER_ID, CUSTOMER_ID, ORDER_DATE, ORDER_STATUS, TOTAL_AMOUNT, CURRENCY, SHIPPING_ADDRESS, PAYMENT_METHOD, CREATED_AT, UPDATED_AT]
        when forbidden column present: []
        when wrong column type:
          ORDER_ID: varchar
          CUSTOMER_ID: varchar
          ORDER_DATE: date
          ORDER_STATUS: varchar
          TOTAL_AMOUNT: number
          CURRENCY: varchar
          SHIPPING_ADDRESS: varchar
          PAYMENT_METHOD: varchar
          CREATED_AT: timestamp
          UPDATED_AT: timestamp
  
  # Validity checks - format/type errors break pipelines
  - invalid_count(ORDER_STATUS) < 200:
      name: "Invalid order statuses"
      valid values: ['pending', 'processing', 'shipped', 'delivered', 'cancelled', 'returned']
      attributes:
        dimension: Validity
  
  - invalid_count(TOTAL_AMOUNT) < 200:
      name: "Invalid order amounts"
      valid min: -100
      valid max: 10000
      attributes:
        dimension: Validity
