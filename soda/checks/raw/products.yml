# RAW Layer - Products Table Quality Checks
# Database: SODA_CERTIFICATION, Schema: RAW
# Table: PRODUCTS (1,000+ records)
# 
# DECISION: "Should we ingest this data without breaking the pipeline?"
# RISK: Pipeline breaks, downstream transformations fail
# QUALITY DIMENSIONS: Validity (format/type errors), Schema (missing columns)

# Dataset discovery configuration for Soda Cloud
discover datasets:
  datasets:
    - include PRODUCTS

# Column profiling configuration for Soda Cloud
profile columns:
  columns:
    - PRODUCTS.%
    - exclude PRODUCTS.CREATED_AT
    - exclude PRODUCTS.UPDATED_AT

# Sample datasets configuration for Soda Cloud
sample datasets:
  datasets:
    - include PRODUCTS

checks for PRODUCTS:
  # Schema validation - prevents transformation failures
  - schema:
      name: "Product table schema validation"
      attributes:
        dimension: Validity
      fail:
        when required column missing: [PRODUCT_ID, PRODUCT_NAME, CATEGORY, SUBCATEGORY, PRICE, CURRENCY, DESCRIPTION, BRAND, SKU, WEIGHT, DIMENSIONS, CREATED_AT, UPDATED_AT]
        when forbidden column present: []
        when wrong column type:
          PRODUCT_ID: varchar
          PRODUCT_NAME: varchar
          CATEGORY: varchar
          SUBCATEGORY: varchar
          PRICE: number
          CURRENCY: varchar
          DESCRIPTION: varchar
          BRAND: varchar
          SKU: varchar
          WEIGHT: number
          DIMENSIONS: varchar
          CREATED_AT: timestamp
          UPDATED_AT: timestamp
  
  # Validity checks - format/type errors break pipelines
  - invalid_count(PRICE) < 100:
      name: "Invalid price values"
      valid min: -50
      valid max: 10000
      attributes:
        dimension: Validity
  
  - invalid_count(CATEGORY) < 50:
      name: "Invalid category values"
      valid values: ['Electronics', 'Clothing', 'Books', 'Home & Garden', 'Sports', 'Toys', 'Health', 'Automotive']
      attributes:
        dimension: Validity
  
  - invalid_count(BRAND) < 30:
      name: "Invalid brand values"
      valid regex: '^.{2,50}$'
      attributes:
        dimension: Validity
